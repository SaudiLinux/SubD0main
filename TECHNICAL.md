# التوثيق التقني لأداة Sub

هذا المستند يوفر معلومات تقنية مفصلة حول كيفية عمل أداة Sub وبنيتها الداخلية.

## نظرة عامة على البنية

تتكون أداة Sub من المكونات الرئيسية التالية:

1. **واجهة سطر الأوامر (CLI)**: تتعامل مع مدخلات المستخدم وتمرر المعلمات إلى المكونات الأخرى.
2. **فئة SubTool**: الفئة الرئيسية التي تنفذ جميع وظائف الأداة.
3. **وحدات الاكتشاف**: وظائف متخصصة لاكتشاف النطاقات الفرعية والمجلدات والملفات.
4. **معالجة النتائج**: وظائف لعرض وحفظ النتائج.

## فئة SubTool

### الخصائص الرئيسية

- `target`: الهدف المراد فحصه (URL).
- `base_url`: عنوان URL الأساسي المستخرج من الهدف.
- `wordlist`: مسار ملف قائمة الكلمات أو None لاستخدام القائمة الافتراضية.
- `threads`: عدد مسارات التنفيذ المتزامنة.
- `output_file`: مسار ملف الإخراج أو None إذا لم يتم تحديده.
- `verbose`: علم يشير إلى ما إذا كان يجب عرض معلومات تفصيلية.
- `subdomains`: مجموعة تخزن النطاقات الفرعية المكتشفة.
- `directories`: مجموعة تخزن المجلدات المكتشفة.
- `files`: مجموعة تخزن الملفات المكتشفة.
- `results`: قائمة تخزن جميع النتائج مع معلومات إضافية.

### الوظائف الرئيسية

#### `_format_target(target)`

تنسيق الهدف بشكل صحيح بإضافة بروتوكول HTTP إذا لم يكن موجوداً.

#### `_get_base_url()`

استخراج عنوان URL الأساسي من الهدف.

#### `_load_wordlist()`

تحميل قائمة الكلمات من ملف أو استخدام القائمة الافتراضية.

#### `discover_subdomains()`

اكتشاف النطاقات الفرعية للهدف باستخدام قائمة الكلمات.

#### `_check_subdomain(subdomain)`

التحقق من وجود نطاق فرعي باستخدام استعلامات DNS.

#### `discover_directories()`

اكتشاف المجلدات المخفية في الهدف باستخدام قائمة الكلمات.

#### `discover_files()`

اكتشاف الملفات المخفية في الهدف باستخدام قائمة الكلمات وامتدادات الملفات الشائعة.

#### `_check_url(url, type_name)`

التحقق من وجود URL (مجلد أو ملف) باستخدام طلبات HTTP.

#### `save_results()`

حفظ النتائج في ملف إذا تم تحديد ملف الإخراج.

#### `run()`

تشغيل جميع عمليات الاكتشاف وعرض النتائج.

## تفاصيل التنفيذ

### اكتشاف النطاقات الفرعية

تستخدم الأداة مكتبة `dnspython` لإجراء استعلامات DNS للتحقق من وجود النطاقات الفرعية. يتم إنشاء النطاقات الفرعية المحتملة عن طريق دمج كل كلمة من قائمة الكلمات مع اسم النطاق الأساسي.

### اكتشاف المجلدات والملفات

تستخدم الأداة مكتبة `requests` لإرسال طلبات HTTP للتحقق من وجود المجلدات والملفات. يتم اعتبار المجلد أو الملف موجوداً إذا كان رمز الاستجابة بين 200 و 399.

### التنفيذ المتوازي

تستخدم الأداة وحدة `concurrent.futures` لتنفيذ عمليات الاكتشاف بشكل متوازٍ، مما يحسن الأداء بشكل كبير. يمكن للمستخدم تحديد عدد مسارات التنفيذ المتزامنة.

## تخصيص الأداة

### إضافة امتدادات ملفات جديدة

يمكن إضافة امتدادات ملفات جديدة عن طريق تعديل قائمة `extensions` في وظيفة `discover_files`.

### تعديل قائمة الكلمات الافتراضية

يمكن تعديل قائمة الكلمات الافتراضية عن طريق تعديل القائمة المرجعة في وظيفة `_load_wordlist` عندما يكون `self.wordlist` هو `None`.

### إضافة وظائف اكتشاف جديدة

يمكن إضافة وظائف اكتشاف جديدة عن طريق إنشاء وظائف جديدة في فئة `SubTool` واستدعائها من وظيفة `run`.

## اعتبارات الأداء

- زيادة عدد مسارات التنفيذ المتزامنة يمكن أن تحسن الأداء، ولكنها قد تؤدي أيضاً إلى استهلاك المزيد من موارد النظام وقد تتسبب في حظر عنوان IP من قبل الخادم المستهدف.
- استخدام قوائم كلمات كبيرة يمكن أن يحسن نتائج الاكتشاف، ولكنه يزيد أيضاً من وقت التنفيذ.
- تم تعيين مهلة الاتصال إلى 5 ثوانٍ لتجنب التأخير الناتج عن الخوادم البطيئة.

## اعتبارات الأمان

- يجب استخدام الأداة فقط على الأنظمة والمواقع التي تملك إذناً صريحاً لاختبارها.
- قد تقوم بعض الخوادم بحظر عنوان IP الخاص بك إذا قمت بإجراء عدد كبير من الطلبات في وقت قصير.
- قد تؤدي بعض عمليات الاكتشاف إلى تسجيل نشاطك في سجلات الخادم المستهدف.

## الاستخدام كمكتبة

يمكن استخدام أداة Sub كمكتبة في مشاريع بايثون أخرى. راجع ملف `examples/example_scan.py` للحصول على مثال.